### 2021-11-16 refactoring

#### 1. DB RDS 분리

- config.js 파일 내 rds 추가
- 환경 변수 추가

```jsx
rds: {
    username: process.env.RDS_USER,
    password: process.env.RDS_PASSWORD,
    database: process.env.RDS_DB_NAME,
    host: process.env.RDS_END_POINT,
    dialect: "mysql",
  },
```

#### 2. 필터페이지 게시물 조회 검색 기능 추가

- 필터페이지 쿼리스트링 추가
- SQL query WHERE 절 조건에 검색 키워드 추가

```jsx
if (keyword)
  condition.push(`Post.title LIKE '%${encodeURIComponent(keyword)}%'`);
```

#### 3. winston file 시스템 적용

- logger console 처리 및 fs 시스템으로 저장
- 각 res 요청 전부 logger 처리 후 fs 시스템 저장 될 수 있도록 처리함.
- ec2 서버 winston 적용 했으나, 시간 설정이 잘 안됨.
- logger.js 파일 수정 부분

```jsx
const timezoned = () => {
  return new Date().toLocaleString("ko-KR", {
    timeZone: "Asia/Seoul",
  });
};

...

const printLogFormat = {
  file: combine(
    label({
      label: "study",
    }),
    timestamp({ format: timezoned }),
    printFormat
  ),
  console: combine(colorize(), simple()),
};
```

#### 4. 회원탈퇴 기능 수정

- 기존 삭제 방식 -> cascade 방식 적용
- 관계 형성 시 FK 삭제 오류 발생
- 관계 맺을 때 sourceKey에 onDelete: "cascade" 적용 시 FK로 등록된 key값만 지워짐

```jsx
db.User.hasMany(db.Post, {
  foreignKey: "userId",
  sourceKey: "userId",
  onDelete: "cascade",
});
```

- 아래 코드 처럼 적용시 targetKey에 해당 되는 모든 key 삭제 처리됨

```jsx
Post.belongsTo(db.User, {
  foreignKey: "userId",
  targetKey: "userId",
  onDelete: "cascade",
});
```
